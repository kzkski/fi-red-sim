# 要件分析と想定回答

## 1. シミュレーションデータの性質

### 想定する実装
1. **データ生成パターン**
   - 基本パターン：実環境に近い自然な変動
   - 日変化パターン：時間帯による変動（昼高く、夜低いなど）
   - ノイズ付加：実環境のセンサーらしい揺らぎの付加
   - カスタムパターン：ユーザー定義の変動パターン

2. **異常値生成**
   - 突発的な異常値（スパイク）
   - センサー故障シミュレーション（一定値、ノイズ増大）
   - 通信エラーシミュレーション（データ欠損）

3. **パラメータ設定**
   - 基準値（平均値）設定
   - 変動幅の設定
   - ノイズレベルの設定
   - 異常発生確率の設定

## 2. 可視化要件

### 想定する実装
1. **グラフ表示**
   - リアルタイム表示（直近5分）
   - 短期トレンド（1時間）
   - 長期トレンド（24時間）
   - マルチタイムスケール表示

2. **データ保存**
   - メモリ上：直近1時間のデータ
   - ファイル保存：24時間分のデータ（オプション）
   - 保存形式：CSV形式でエクスポート可能

3. **表示形式**
   - リアルタイム数値表示
   - トレンドグラフ（折れ線）
   - 統計情報（最小、最大、平均）
   - マルチデバイス比較表示

## 3. シミュレーション制御

### 想定する実装
1. **時間制御**
   - 実時間での実行（1秒=1秒）
   - 高速実行（最大10倍速）
   - 低速実行（最小0.1倍速）
   - 一時停止/再開機能

2. **実行モード**
   - 連続実行モード（標準）
   - 期間指定実行（開始時刻、終了時刻）
   - イベントトリガー実行

3. **パラメータ制御**
   - リアルタイムパラメータ調整
   - プリセット設定の保存/読み込み
   - バッチ設定の適用

## 4. 開発環境

### 想定する実装
1. **Node-RED環境**
   - バージョン：3.1.0以上
   - コンテナ化：Docker環境
   - メモリ割り当て：最小512MB

2. **必須ノード**
   - node-red-dashboard
   - node-red-contrib-moment
   - node-red-contrib-statistics
   - node-red-contrib-chartjs

3. **推奨ノード**
   - node-red-contrib-simple-message-queue
   - node-red-contrib-throttle
   - node-red-contrib-csv

## 5. デバイスシミュレーションの詳細

### 想定する実装
1. **スケール**
   - 単一デバイスタイプ：最大10台同時実行
   - 全デバイスタイプ合計：最大30台同時実行
   - メモリ使用制限：デバイス1台あたり約10MB

2. **デバイス間連携**
   - 基本的な相互作用（温度→空調制御）
   - 環境シミュレーション（部屋の温度変化）
   - 単純な制御ロジック

3. **デバイス管理**
   - デバイス一覧表示
   - 個別デバイス制御
   - グループ制御
   - テンプレートからの一括生成

## 6. パフォーマンス要件

### 想定する実装
1. **データ更新頻度**
   - 標準：1回/秒
   - 高速：最大10回/秒
   - 低速：最小1回/10秒

2. **レスポンス時間**
   - UI操作：200ms以内
   - グラフ更新：500ms以内
   - 設定変更反映：1秒以内

3. **リソース使用**
   - CPU使用率：平均30%以下
   - メモリ使用：最大1GB
   - ディスク使用：最大1GB（24時間分）

## 7. センサー種類とデータモデル

### 対応予定センサー
1. **環境センサー**
   - 温度センサー
   - 湿度センサー
   - CO2センサー
   - 照度センサー
   - 気圧センサー
   - 騒音センサー

2. **ユーティリティセンサー**
   - 電力メーター
   - 水道メーター
   - ガスメーター
   - 人感センサー
   - 扉開閉センサー

3. **農業/環境センサー**
   - 土壌水分センサー
   - 土壌温度センサー
   - 日射量センサー
   - 風向風速センサー
   - 雨量センサー

4. **産業用センサー**
   - 振動センサー
   - 傾斜センサー
   - 重量センサー
   - 距離センサー
   - 速度センサー

### データモデル
- Smart Data Models (FIWARE/IUDX/OASC) に準拠
- 主な参照モデル：
  - Device model
  - DeviceModel model
  - DeviceMeasurement model
  - TemperatureSensor model（初期実装用）

## 8. 段階的実装計画

### フェーズ1：基本機能実装
1. **対象センサー**
   - 温度センサーのみ
   - Smart Data Modelsの`TemperatureSensor`モデルに準拠

2. **実装機能**
   - 基本的なデータ生成（自然な変動のみ）
   - シンプルなグラフ表示（リアルタイムのみ）
   - 1台のセンサーシミュレーション
   - 基本的なパラメータ設定

### フェーズ2：機能拡張
1. **センサー追加**
   - 湿度センサー
   - CO2センサー
   - 照度センサー

2. **機能追加**
   - 異常値生成
   - トレンド表示
   - マルチデバイス表示
   - データエクスポート

### フェーズ3：高度な機能
1. **センサー拡張**
   - 電力メーター
   - 人感センサー
   - その他センサー（要件に応じて）

2. **機能拡張**
   - デバイス間連携
   - 環境シミュレーション
   - バッチ処理
   - カスタムパターン

### フェーズ4：完全実装
1. **センサー完全対応**
   - 全予定センサーの実装
   - カスタムセンサー追加機能

2. **機能完成**
   - 高度な制御機能
   - 詳細な統計分析
   - システム全体の最適化 