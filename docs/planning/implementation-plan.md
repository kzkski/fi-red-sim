# Fi-Red-Sim 実装計画

## 1. 実装フェーズ

### フェーズ1: 基本シミュレーション機能の実装
**目標**: 単一のセンサーデバイスのシミュレーションと可視化の実現

1. 開発環境の構築
   - [ ] Node-RED Dockerコンテナの設定
   - [ ] 必要なNode-REDノードのインストール設定
   - [ ] 開発用ダッシュボードの初期設定

2. 基本シミュレーション機能の実装
   - [ ] 温度センサーシミュレーションフローの作成
     - 基本的なセンサー値生成ロジック
     - パラメータ設定機能
     - データ出力インターフェース
   - [ ] シミュレーション制御機能
     - 開始/停止制御
     - パラメータ調整機能
     - 基本的なエラーハンドリング

3. 基本可視化機能の実装
   - [ ] リアルタイムデータ表示
     - 現在値の数値表示
     - 時系列グラフ表示
   - [ ] 基本的な制御UI
     - シミュレーション開始/停止ボタン
     - パラメータ設定フォーム

### フェーズ2: 機能拡張とマルチデバイス対応
**目標**: 複数種類のデバイスシミュレーションと高度な可視化機能の実現

1. デバイスタイプの拡張
   - [ ] 湿度センサー
   - [ ] CO2センサー
   - [ ] 人感センサー
   - [ ] スイッチ/アクチュエータ

2. 高度なシミュレーション機能
   - [ ] デバイス間の相互作用
   - [ ] 異常系シナリオ
   - [ ] バッテリー残量シミュレーション

3. 可視化機能の拡張
   - [ ] マルチデバイスダッシュボード
   - [ ] アラート表示機能
   - [ ] デバイス状態一覧

### フェーズ3: FIWARE連携機能の実装
**目標**: FIWAREテスト環境との基本連携の実現

1. FIWARE連携基盤の実装
   - [ ] NGSIv2データモデルの実装
   - [ ] Context Broker連携機能
   - [ ] エラーハンドリング

2. テスト環境との統合
   - [ ] テストシナリオの実装
   - [ ] 動作検証機能
   - [ ] ログ収集機能

## 2. ディレクトリ構成

```
fi-red-sim/
├── docker/                     # Docker関連ファイル
│   ├── node-red/              # Node-RED用Dockerfile等
│   └── fiware/                # FIWARE用Dockerfile等（オプション）
│
├── flows/                     # Node-REDフロー定義
│   ├── simulations/          # シミュレーションフロー
│   │   ├── sensors/         # センサーデバイス用フロー
│   │   └── actuators/       # アクチュエータ用フロー
│   ├── visualizations/       # 可視化用フロー
│   └── integrations/         # 外部連携用フロー
│
├── config/                    # 設定ファイル
│   ├── node-red/             # Node-RED設定
│   └── devices/              # デバイス定義
│
├── docs/                      # ドキュメント
│   ├── planning/             # 計画ドキュメント
│   ├── api/                  # API仕様
│   └── usage/                # 使用方法
│
├── tests/                     # テストファイル
│   ├── flows/                # フローテスト
│   ├── integration/          # 統合テスト
│   └── performance/          # 性能テスト
│
└── scripts/                   # ユーティリティスクリプト
    ├── setup/                # セットアップスクリプト
    └── maintenance/          # メンテナンス用スクリプト
```

## 3. 開発ガイドライン

### フロー開発ルール
1. 各フローは単一の責務を持つ
2. フロー間の依存関係を明確にする
3. エラーハンドリングを必ず実装
4. デバッグノードを適切に配置

### コンポーネント分割の方針
1. シミュレーションロジック
   - デバイスタイプごとに分離
   - パラメータ設定を外部化
   - 再利用可能なサブフロー化

2. 可視化コンポーネント
   - 機能ごとにタブ分割
   - 共通UIコンポーネントの標準化
   - レスポンシブデザインの考慮

### 命名規則
1. フロー
   - デバイスシミュレーション: `sim-{deviceType}-{function}`
   - 可視化: `viz-{deviceType}-{component}`
   - 統合: `int-{system}-{function}`

2. ノード
   - 入力: `input-{purpose}`
   - 処理: `proc-{function}`
   - 出力: `output-{destination}`

## 4. 実装の優先順位

1. 最初のイテレーション（2週間）
   - 基本的な温度センサーシミュレーション
   - シンプルなダッシュボード表示
   - 開始/停止制御

2. 第2イテレーション（2週間）
   - パラメータ調整機能
   - グラフ表示の改善
   - エラーハンドリング

3. 第3イテレーション（2週間）
   - 追加デバイスタイプ
   - マルチデバイス表示
   - 基本的なFIWARE連携

各イテレーションの終了時にレビューを行い、必要に応じて計画を調整します。 